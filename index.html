
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Asistencia de Estudiantes â€” VERSIÃ“N DE MUESTRA</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#24496e" />

    <!-- SheetJS -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" crossorigin></script>

    <style>
      :root{
        --azul:#24496e;
        --crema:#f3efdc;
        --violeta:#6c467e;
        --salmon:#da6863;
      }
      body{ background:var(--crema); }
      /* Cinta de versiÃ³n de muestra */
      .ribbon {
        position: fixed;
        top: 12px;
        right: -40px;
        transform: rotate(45deg);
        background: #1e3a5f;
        color: #fff;
        padding: 8px 60px;
        font-weight: 800;
        letter-spacing: .08em;
        z-index: 1000;
        box-shadow: 0 6px 12px rgba(0,0,0,.2);
      }
      .trial-watermark{
        position: fixed;
        left: 0; right: 0; bottom: 12px;
        text-align: center;
        color: #1e3a5f;
        opacity: .35;
        font-weight: 800;
        letter-spacing: .12em;
        z-index: 999;
        pointer-events: none;
      }
    </style>
  </head>
  <body class="min-h-dvh text-slate-900">
    <div class="ribbon">VERSIÃ“N DE MUESTRA</div>
    <div class="trial-watermark">VERSIÃ“N DE MUESTRA</div>
    <div id="root"></div>

    <!-- React 18 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

    <!-- Firebase SDKs (se conservan como en la versiÃ³n completa) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

    <script>
      // MODO PRUEBA
      window.__TRIAL_VERSION__ = true;
    </script>

    <!-- App original -->
    <script src="app.js"></script>

    <!-- Limitador de cursos para versiÃ³n de prueba -->
    <script>
      (function(){
        const LS_KEY = 'agenda_estudiantes_sin_google_v5';
        function getCourseCount(){
          try{
            const s = JSON.parse(localStorage.getItem(LS_KEY)||'{}');
            const c = s && s.courses ? Object.keys(s.courses).length : 0;
            return c|0;
          }catch(_){ return 0; }
        }

        function blockIfExceeded(ev){
          const count = getCourseCount();
          if(count >= 1){
            if(ev){ ev.stopImmediatePropagation(); ev.stopPropagation(); ev.preventDefault(); }
            alert('En la VERSIÃ“N DE MUESTRA solo se puede cargar hasta 1 curso.');
            return true;
          }
          return false;
        }

        // Capturamos clicks antes que React
        document.addEventListener('click', function(ev){
          const t = ev.target;
          if(!t) return;
          const txt = (t.innerText||'').trim().toLowerCase();
          // Botones relevantes: "+ Nuevo curso" y "Crear curso"
          if(txt === '+ nuevo curso' || txt === 'crear curso'){
            blockIfExceeded(ev);
          }
        }, true); // captura

        // Observador para poner leyenda "VERSIÃ“N DE MUESTRA" en el header
        const obs = new MutationObserver(() => {
          const hdr = document.querySelector('header .tracking-tight');
          if(hdr && !document.getElementById('trial-tag')){
            const tag = document.createElement('span');
            tag.id = 'trial-tag';
            tag.className = 'ml-3 text-xs font-bold px-2 py-1 rounded-full';
            tag.style.background = '#f0eaf5';
            tag.style.color = '#6c467e';
            tag.textContent = 'VERSIÃ“N DE MUESTRA';
            hdr.parentNode.appendChild(tag);
          }
        });
        obs.observe(document.documentElement, { childList:true, subtree:true });
      })();
    </script>

    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      }
    </script>

    <footer class="p-6 md:p-8 text-sm text-slate-700">
      <div class="max-w-3xl mx-auto space-y-3">
        <h3 class="text-base md:text-lg font-semibold" style="color:var(--azul)">Â¿CÃ³mo instalar en el celular?</h3>
        <ol class="list-decimal ml-5 space-y-1">
          <li>En Android/Chrome: MenÃº â‹® â†’ <em>Agregar a la pantalla principal</em>.</li>
          <li>En iOS/Safari: Compartir â†’ <em>AÃ±adir a inicio</em>.</li>
        </ol>
        <div class="mt-8 text-center">
          <a href="https://cafecito.app/docentesbrown" target="_blank" rel="noopener"
             class="inline-block px-5 py-3 rounded-2xl text-white font-semibold shadow"
             style="background:var(--salmon)">
            â˜• Bancanos con un cafecito
          </a>
        </div>
        <div class="mt-4 text-center">
          <button onclick="window.__openExport && window.__openExport()"
                  class="inline-block px-5 py-3 rounded-2xl text-white font-semibold shadow"
                  style="background:var(--azul)">
            ðŸ“‚ Exportar / Importar
          </button>
        </div>
      </div>
    </footer>
  </body>
</html>
